distribute result [$$247]
-- DISTRIBUTE_RESULT  |PARTITIONED|
  exchange
  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
    project ([$$247])
    -- STREAM_PROJECT  |PARTITIONED|
      subplan {
                aggregate [$$247] <- [listify($$246)]
                -- AGGREGATE  |LOCAL|
                  assign [$$246] <- [{"channelExecutionTime": $$277, "result": $$278, "BrokerEndpoint": $$BrokerEndpoint}]
                  -- ASSIGN  |LOCAL|
                    group by ([$$BrokerEndpoint := $$250]) decor ([$$277 := $$279; $$278 := $$280]) {
                              aggregate [] <- []
                              -- AGGREGATE  |LOCAL|
                                nested tuple source
                                -- NESTED_TUPLE_SOURCE  |LOCAL|
                           }
                    -- MICRO_PRE_CLUSTERED_GROUP_BY[$$250]  |LOCAL|
                      order (ASC, $$250)
                      -- MICRO_STABLE_SORT [$$250(ASC)]  |LOCAL|
                        assign [$$250] <- [$$sub.getField("BrokerEndpoint")] project: [$$280, $$279, $$250]
                        -- ASSIGN  |LOCAL|
                          unnest $$sub <- scan-collection($$239) project: [$$280, $$279, $$sub]
                          -- UNNEST  |LOCAL|
                            project ([$$280, $$279, $$239])
                            -- STREAM_PROJECT  |LOCAL|
                              subplan {
                                        aggregate [$$239] <- [listify($$238)]
                                        -- AGGREGATE  |LOCAL|
                                          assign [$$238] <- [{"sub": $$sub}]
                                          -- ASSIGN  |LOCAL|
                                            unnest $$sub <- scan-collection($$276) project: [$$sub]
                                            -- UNNEST  |LOCAL|
                                              project ([$$276])
                                              -- STREAM_PROJECT  |LOCAL|
                                                nested tuple source
                                                -- NESTED_TUPLE_SOURCE  |LOCAL|
                                     }
                              -- SUBPLAN  |LOCAL|
                                project ([$$280, $$279, $$276])
                                -- STREAM_PROJECT  |LOCAL|
                                  nested tuple source
                                  -- NESTED_TUPLE_SOURCE  |LOCAL|
             }
      -- SUBPLAN  |PARTITIONED|
        project ([$$280, $$279, $$276])
        -- STREAM_PROJECT  |PARTITIONED|
          commit
          -- COMMIT  |PARTITIONED|
            project ([$$280, $$279, $$276, $$234])
            -- STREAM_PROJECT  |PARTITIONED|
              exchange
              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                insert into channels.EmergenciesNearMeChannelResults from record: $$251 partitioned by [$$234]
                -- INSERT_DELETE  |PARTITIONED|
                  exchange
                  -- HASH_PARTITION_EXCHANGE [$$234]  |PARTITIONED|
                    assign [$$280, $$279, $$276, $$234] <- [$$251.getField("result"), $$251.getField("channelExecutionTime"), $$251.getField("brokerSubIds"), $$251.getField(0)]
                    -- ASSIGN  |PARTITIONED|
                      assign [$$251] <- [cast(check-unknown(put-autogenerated-key($$232, "resultId")))] project: [$$251]
                      -- ASSIGN  |PARTITIONED|
                        assign [$$232] <- [{"result": $$result, "channelExecutionTime": current-datetime(), "channelSubId": $$286, "deliveryTime": current-datetime(), "brokerSubIds": $$231}] project: [$$232]
                        -- ASSIGN  |PARTITIONED|
                          project ([$$231, $$result, $$286])
                          -- STREAM_PROJECT  |PARTITIONED|
                            exchange
                            -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                              group by ([$$289 := $$287]) decor ([$$result; $$286]) {
                                        aggregate [$$231] <- [listify({"BrokerEndPoint": $$273, "brokerSubId": $$258})]
                                        -- AGGREGATE  |LOCAL|
                                          select (not(is-missing($$288)))
                                          -- STREAM_SELECT  |LOCAL|
                                            project ([$$273, $$258, $$288])
                                            -- STREAM_PROJECT  |LOCAL|
                                              nested tuple source
                                              -- NESTED_TUPLE_SOURCE  |LOCAL|
                                     }
                              -- PRE_CLUSTERED_GROUP_BY[$$287]  |PARTITIONED|
                                exchange
                                -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                  order (ASC, $$287)
                                  -- STABLE_SORT [$$287(ASC)]  |PARTITIONED|
                                    exchange
                                    -- HASH_PARTITION_EXCHANGE [$$287]  |PARTITIONED|
                                      project ([$$result, $$286, $$273, $$258, $$288, $$287])
                                      -- STREAM_PROJECT  |PARTITIONED|
                                        exchange
                                        -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                          left outer join (eq($$257, $$286))
                                          -- HYBRID_HASH_JOIN [$$286][$$257]  |PARTITIONED|
                                            exchange
                                            -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                              running-aggregate [$$287] <- [create-query-uid()]
                                              -- RUNNING_AGGREGATE  |PARTITIONED|
                                                unnest $$result <- scan-collection($$211) project: [$$result, $$286]
                                                -- UNNEST  |PARTITIONED|
                                                  exchange
                                                  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                    group by ([$$286 := $$253]) decor ([]) {
                                                              aggregate [$$211] <- [listify({"report": $$r, "shelters": $$201})]
                                                              -- AGGREGATE  |LOCAL|
                                                                group by ([$$282 := $$254; $$283 := $$255]) decor ([$$272; $$sub; $$r; $$u; $$262; $$263; $$264; $$253]) {
                                                                          aggregate [$$201] <- [listify({"location": $$252})]
                                                                          -- AGGREGATE  |LOCAL|
                                                                            select (not(is-missing($$256)))
                                                                            -- STREAM_SELECT  |LOCAL|
                                                                              project ([$$256, $$252])
                                                                              -- STREAM_PROJECT  |LOCAL|
                                                                                nested tuple source
                                                                                -- NESTED_TUPLE_SOURCE  |LOCAL|
                                                                       }
                                                                -- MICRO_PRE_CLUSTERED_GROUP_BY[$$254, $$255]  |LOCAL|
                                                                  select (and(not(is-missing($$284)), not(is-missing($$285))))
                                                                  -- STREAM_SELECT  |LOCAL|
                                                                    nested tuple source
                                                                    -- NESTED_TUPLE_SOURCE  |LOCAL|
                                                           }
                                                    -- PRE_CLUSTERED_GROUP_BY[$$253]  |PARTITIONED|
                                                      exchange
                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                        order (ASC, $$253) (ASC, $$254) (ASC, $$255)
                                                        -- STABLE_SORT [$$253(ASC), $$254(ASC), $$255(ASC)]  |PARTITIONED|
                                                          exchange
                                                          -- HASH_PARTITION_EXCHANGE [$$253]  |PARTITIONED|
                                                            select (spatial-intersect($$252, $$264)) retain-untrue ($$256 <- missing)
                                                            -- STREAM_SELECT  |PARTITIONED|
                                                              assign [$$252] <- [$$s.getField(1)] project: [$$253, $$sub, $$262, $$254, $$r, $$263, $$272, $$284, $$255, $$u, $$285, $$264, $$256, $$252]
                                                              -- ASSIGN  |PARTITIONED|
                                                                project ([$$253, $$sub, $$262, $$254, $$r, $$263, $$272, $$284, $$255, $$u, $$285, $$264, $$256, $$s])
                                                                -- STREAM_PROJECT  |PARTITIONED|
                                                                  exchange
                                                                  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                    left-outer-unnest-map [$$256, $$s] <- index-search("Shelters", 0, "Default", "channels", "Shelters", true, false, 1, $$309, 1, $$309, true, true, true)
                                                                    -- BTREE_SEARCH  |PARTITIONED|
                                                                      exchange
                                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                        order (ASC, $$309)
                                                                        -- STABLE_SORT [$$309(ASC)]  |PARTITIONED|
                                                                          exchange
                                                                          -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                            project ([$$253, $$sub, $$262, $$254, $$r, $$263, $$272, $$284, $$255, $$u, $$285, $$264, $$309])
                                                                            -- STREAM_PROJECT  |PARTITIONED|
                                                                              exchange
                                                                              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                left-outer-unnest-map [$$305, $$306, $$307, $$308, $$309] <- index-search("s_location", 1, "Default", "channels", "Shelters", true, true, 4, $$301, $$302, $$303, $$304)
                                                                                -- RTREE_SEARCH  |PARTITIONED|
                                                                                  exchange
                                                                                  -- BROADCAST_EXCHANGE  |PARTITIONED|
                                                                                    assign [$$301, $$302, $$303, $$304] <- [create-mbr($$264, 2, 0), create-mbr($$264, 2, 1), create-mbr($$264, 2, 2), create-mbr($$264, 2, 3)]
                                                                                    -- ASSIGN  |PARTITIONED|
                                                                                      exchange
                                                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                        left outer join (and(spatial-intersect($$263, $$264), eq($$255, $$262)))
                                                                                        -- HYBRID_HASH_JOIN [$$262][$$255]  |PARTITIONED|
                                                                                          exchange
                                                                                          -- HASH_PARTITION_EXCHANGE [$$262]  |PARTITIONED|
                                                                                            left outer join (true)
                                                                                            -- NESTED_LOOP  |PARTITIONED|
                                                                                              exchange
                                                                                              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                assign [$$262] <- [$$sub.getField("param0")]
                                                                                                -- ASSIGN  |PARTITIONED|
                                                                                                  exchange
                                                                                                  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                    data-scan []<-[$$253, $$sub] <- channels.EmergenciesNearMeChannelChannelSubscriptions
                                                                                                    -- DATASOURCE_SCAN  |PARTITIONED|
                                                                                                      exchange
                                                                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                        empty-tuple-source
                                                                                                        -- EMPTY_TUPLE_SOURCE  |PARTITIONED|
                                                                                              exchange
                                                                                              -- BROADCAST_EXCHANGE  |PARTITIONED|
                                                                                                assign [$$284] <- [true]
                                                                                                -- ASSIGN  |PARTITIONED|
                                                                                                  select (gt($$272, numeric-subtract(current-datetime(), day_time_duration: {PT10S })))
                                                                                                  -- STREAM_SELECT  |PARTITIONED|
                                                                                                    assign [$$263, $$272] <- [$$r.getField(2), $$r.getField(3)]
                                                                                                    -- ASSIGN  |PARTITIONED|
                                                                                                      exchange
                                                                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                        data-scan []<-[$$254, $$r] <- channels.Reports
                                                                                                        -- DATASOURCE_SCAN  |PARTITIONED|
                                                                                                          exchange
                                                                                                          -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                            empty-tuple-source
                                                                                                            -- EMPTY_TUPLE_SOURCE  |PARTITIONED|
                                                                                          exchange
                                                                                          -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                            assign [$$285, $$264] <- [true, $$u.getField(0)]
                                                                                            -- ASSIGN  |PARTITIONED|
                                                                                              exchange
                                                                                              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                data-scan []<-[$$255, $$u] <- channels.UserLocations
                                                                                                -- DATASOURCE_SCAN  |PARTITIONED|
                                                                                                  exchange
                                                                                                  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                                                    empty-tuple-source
                                                                                                    -- EMPTY_TUPLE_SOURCE  |PARTITIONED|
                                            exchange
                                            -- HASH_PARTITION_EXCHANGE [$$257]  |PARTITIONED|
                                              assign [$$288] <- [true]
                                              -- ASSIGN  |PARTITIONED|
                                                project ([$$258, $$257, $$273])
                                                -- STREAM_PROJECT  |PARTITIONED|
                                                  exchange
                                                  -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                    join (and(eq($$268, $$259), eq($$270, $$260)))
                                                    -- HYBRID_HASH_JOIN [$$268, $$270][$$259, $$260]  |PARTITIONED|
                                                      exchange
                                                      -- HASH_PARTITION_EXCHANGE [$$268, $$270]  |PARTITIONED|
                                                        assign [$$270, $$268] <- [$$bs.getField("BrokerName"), $$bs.getField("DataverseName")] project: [$$258, $$257, $$268, $$270]
                                                        -- ASSIGN  |PARTITIONED|
                                                          exchange
                                                          -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                            data-scan []<-[$$257, $$258, $$bs] <- channels.EmergenciesNearMeChannelBrokerSubscriptions
                                                            -- DATASOURCE_SCAN  |PARTITIONED|
                                                              exchange
                                                              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                empty-tuple-source
                                                                -- EMPTY_TUPLE_SOURCE  |PARTITIONED|
                                                      exchange
                                                      -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                        assign [$$273] <- [$$b.getField("BrokerEndPoint")] project: [$$273, $$259, $$260]
                                                        -- ASSIGN  |PARTITIONED|
                                                          exchange
                                                          -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                            data-scan []<-[$$259, $$260, $$b] <- channels.Broker
                                                            -- DATASOURCE_SCAN  |PARTITIONED|
                                                              exchange
                                                              -- ONE_TO_ONE_EXCHANGE  |PARTITIONED|
                                                                empty-tuple-source
                                                                -- EMPTY_TUPLE_SOURCE  |PARTITIONED|
